<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript" src="http://libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>

  <link rel="stylesheet" href="resource/acss/Ahomepage.css">
  <script src="resource/ujs/general.js"></script>
  <script src="resource/ujs/cookie.js"></script>

  <title>Document</title>
  <!-- 新 Bootstrap4 核心 CSS 文件 -->
  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css">

  <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
  <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>

  <!-- bootstrap.bundle.min.js 用于弹窗、提示、下拉菜单，包含了 popper.min.js -->
  <script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>

  <!-- 最新的 Bootstrap4 核心 JavaScript 文件 -->
  <script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>


  <title>Document</title>
  <link rel="stylesheet" href="resource/acss/Ahomepage.css">

</head>

<script>

</script>
<body onload="viewSong()">
<div class="top">
  <div class="top_left">
    音乐系统
  </div>
  <div class="top_right">
    <div class="text">
      音乐信息页
    </div>
    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"/>
      <span>用户1</span>
      <div class="dropdown-menu">
        <a class="dropdown-item" href="#">个人信息</a>
        <a id="backLo" class="dropdown-item" href="Alogin.html">退出登录</a>
      </div>
  </div>


</div>
<div class="bottom">
  <div class="bottom_left">
    <ul>
      <li><a href="">下架查询</a></li>
      <li><a href="AddSong.html">上传音乐</a></li>
      <li><a href="">音乐信息</a></li>
      <li><a href="">购买信息</a></li>
    </ul>
  </div>
  <div class="bottom_right">
    <div class="content">
      <table class="table table-bordered table-striped table-hover">
        <thead>
        <tr class="table-primary">
          <th>类型</th>
          <th>歌名</th>
          <th>作者</th>
          <th>时长</th>
          <th>价格</th>
          <th>操作</th>
        </tr>
        </thead>
        <tbody id="songInf">
<!--        动态数据-->
        </tbody>
      </table>
    </div>
  </div>
</div>
</body>
<script>

  //如果没有登录就跳转到登录页面；



  $("#backLo").click(function (){
    location.href="Ulogin.html";
  })

  //歌曲显示
  function viewSong(){
    $.ajax({
      type:"get",
      url:"search?user=1",
      success:function (data){
        var arr = data.data;
        for(var i  = 0;i< arr.length;i++){
          $("#songInf").append("<tr>" +
                  "<th>"+arr[i].typename+"</th>" +
                  "<td>"+arr[i].songname+"</td>" +
                  "<td>"+arr[i].singer+"</td>" +
                  "<td>"+arr[i].time+"</td>" +
                  "<td>"+arr[i].price+"</td>" +
                  "<td>" +
                  "<input style='width: 50px' type='button' index = '"+arr[i].id+"' class='updateSong' value='修改'/>" +
                  "<input style='width: 50px' type='button' index = '"+arr[i].id+"' class='delSong' value='删除'/>" +
                  "</td>" +
                  "</tr>")
        }
      }
    })
  }
  //删除歌曲操作
  $("#songInf").on("click",".delSong",function (){
    var id = $(this).attr("index");
    console.log("id:"+id);
    $.ajax({
      type:"post",
      url: "del",
      data:{"id":id},
      success:function (data){
        console.log(data);
        if(data.code == 1){
          alert(data.message);
          location.reload();
        }else {
          alert(data.message);
        }
      }
    })
  })

  //跳转到修改页面
  $("#songInf").on("click",".updateSong",function (){
    var id = $(this).attr("index");
    setCookie("id",id);
    location.href="UpdateSong.html"
  })

</script>
</html>